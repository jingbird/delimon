# Issue #27: エラーハンドリング・ローディング状態の強化

### 背景 / 目的
全画面で一貫したエラーハンドリングとローディング表示を実装し、ユーザー体験を向上させる。

- **依存**: 全機能実装後（#1〜#26）
- **ラベル**: `frontend`, `infra`

---

### スコープ / 作業項目

#### 1. TanStack Queryのエラーハンドリング統一
- `src/lib/queryClient.ts` でグローバルエラーハンドリングを設定
- 3回リトライ、指数バックオフ（1秒、2秒、4秒）
- エラー時のデフォルト処理を定義

#### 2. ネットワークエラーハンドリング
- ネットワークエラー時に「ネットワークに接続できません」ダイアログ表示
- リトライボタンを配置

#### 3. ローディングインジケーターの統一
- `src/components/common/LoadingSpinner.tsx` を作成
- 全API呼び出しでローディング表示
- React Native PaperのActivityIndicatorを使用

#### 4. GPS権限エラーハンドリング
- GPS権限がない場合、「位置情報へのアクセスを許可してください」ダイアログ表示
- 設定画面への誘導ボタンを配置

#### 5. ErrorBoundaryの実装
- `src/components/common/ErrorBoundary.tsx` を作成
- 予期しないエラーをキャッチし、エラー画面を表示
- 「アプリを再起動」ボタンを配置

#### 6. Toastメッセージの統一
- `src/utils/toast.ts` を作成
- 成功・エラー・警告メッセージを統一的に表示

---

### ゴール / 完了条件（Acceptance Criteria）

- [ ] TanStack Queryのエラーハンドリングを統一（3回リトライ、指数バックオフ）
- [ ] ネットワークエラー時に「ネットワークに接続できません」ダイアログ表示＋リトライボタン
- [ ] 全API呼び出しでローディングインジケーター表示
- [ ] GPS権限エラー時に設定画面への誘導ダイアログ表示
- [ ] ErrorBoundaryで予期しないエラーをキャッチし、エラー画面表示

---

### テスト観点

#### 手動テスト
- ネットワークをOFFにし、API呼び出しでエラーダイアログが表示されることを確認
- リトライボタンをタップし、再度API呼び出しが実行されることを確認
- GPS権限を拒否し、配送開始時に誘導ダイアログが表示されることを確認
- 設定画面への誘導ボタンをタップし、設定画面が開くことを確認
- 意図的にエラーを発生させ、ErrorBoundaryがキャッチすることを確認

#### 検証方法
1. ネットワークをOFFにしてアプリを起動
2. ホーム画面でエラーダイアログが表示されることを確認
3. リトライボタンをタップし、再試行されることを確認
4. GPS権限を拒否し、配送開始ボタンをタップ
5. 誘導ダイアログが表示されることを確認
6. 「設定を開く」ボタンをタップし、設定画面が開くことを確認

---

### 参考資料

- [TanStack Query Error Handling](https://tanstack.com/query/latest/docs/react/guides/query-retries)
- [React Error Boundaries](https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary)

---

### 要確認事項

- リトライ回数（3回）は適切か
- エラーメッセージの文言統一
- ErrorBoundaryのエラー画面デザイン
