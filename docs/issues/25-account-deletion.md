# Issue #25: アカウント削除機能の実装

### 背景 / 目的
ユーザーが自分のアカウントとすべてのデータを削除できる機能を実装し、個人情報保護法（GDPR等）に対応する。

- **依存**: #23
- **ラベル**: `frontend`, `backend`, `feature`

---

### スコープ / 作業項目

#### 1. アカウント削除確認画面の作成
- `app/settings/delete-account.tsx` を作成
- 警告メッセージと削除されるデータのリストを表示

#### 2. 削除されるデータのリスト表示
以下のデータが削除されることを明示:
- プロフィール情報（ニックネーム、生年月日、性別、業種）
- 相棒キャラクター情報
- 配送履歴
- アカウント情報（メールアドレス、パスワード）

#### 3. 確認チェックボックス
- 「上記の内容を理解しました」チェックボックスを配置
- チェックONで削除ボタンを有効化

#### 4. アカウント削除処理
- 削除ボタンタップで最終確認ダイアログ表示
- 「はい」でSupabaseから以下を削除:
  - `users` テーブルのレコード（CASCADE DELETEで `characters`, `delivery_sessions` も自動削除）
  - Supabase Authのユーザーアカウント

#### 5. ローカルストレージのクリア
- 削除完了後、ローカルストレージをクリア
- ログイン画面へ遷移

#### 6. エラーハンドリング
- ネットワークエラー時に「削除に失敗しました」ダイアログ表示
- リトライ機能を提供

---

### ゴール / 完了条件（Acceptance Criteria）

- [ ] `app/settings/delete-account.tsx` でアカウント削除確認画面を作成完了
- [ ] 削除されるデータのリスト（キャラクター・配送履歴・プロフィール等）を表示できる
- [ ] 「上記の内容を理解しました」チェックボックスがONで削除ボタン有効化
- [ ] 削除ボタンタップで最終確認ダイアログ表示、確認後にSupabaseからユーザー削除（CASCADE DELETEで関連データも削除）
- [ ] 削除完了後にローカルストレージクリア→ログイン画面へ遷移

---

### テスト観点

#### 手動テスト
- 設定メニューから「アカウント削除」をタップし、確認画面が表示されることを確認
- 削除されるデータのリストが表示されることを確認
- チェックボックスをONにし、削除ボタンが有効化されることを確認
- 削除ボタンをタップし、最終確認ダイアログが表示されることを確認
- 「はい」でアカウント削除が実行されることを確認
- Supabase Dashboardで `users`, `characters`, `delivery_sessions` テーブルからレコードが削除されていることを確認
- ログイン画面へ遷移し、削除したアカウントでログインできないことを確認

#### 検証方法（テストアカウントで実施）
1. テストアカウントでログイン
2. 設定メニューから「アカウント削除」をタップ
3. 確認画面で「上記の内容を理解しました」にチェック
4. 削除ボタンをタップし、最終確認ダイアログで「はい」を選択
5. Supabase Dashboardでデータが削除されていることを確認
6. ログイン画面へ遷移し、削除したアカウントでログインできないことを確認

---

### 参考資料

- `docs/03_database_delimon.md` - データベース設計（CASCADE DELETE設定）
- `docs/05_sitemap_delimon.md` - サイトマップ（アカウント削除画面）

---

### 要確認事項

- CASCADE DELETE設定の確認（関連データが自動削除されるか）
- アカウント削除後のデータ復旧の可否（Phase 1では復旧不可）
- 削除前のデータエクスポート機能の要否（Phase 1では不要）
- GDPR対応の確認（EU圏ユーザーへの対応）
